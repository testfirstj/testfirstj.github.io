<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.16">
<meta name="description" content="This site contains the theory and exercise descriptions of PRC2 (Java Programming 2), starting in February 2021.">
<meta name="keywords" content="Test Driven Java SEBI Venlo">
<meta name="author" content="Martijn Bonajo, Richard van den Ham, Pieter van den Hombergh, Linda Urselmans">
<title>W4 Generics</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<link rel="stylesheet" href="css/asciidoctor.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="css/coderay-asciidoctor.css">
<link rel="stylesheet" href="css/sebistyle.css">
<link rel="stylesheet" href="css/mooc.css">
<link rel="icon" type="image/png" href="images/Java_Logo.png?v=3"/>
<script src="js/top.js" type="text/javascript"></script>
</head>
<body class="article toc2 toc-right">
<div id="header">
<h1>W4 Generics</h1>
<div class="details">
<span id="author" class="author">Martijn Bonajo, Richard van den Ham, Pieter van den Hombergh, Linda Urselmans</span><br>
<span id="revdate">V2.0  2021-01-10</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_generics_the_fine_print">1. Generics, the fine print</a>
<ul class="sectlevel2">
<li><a href="#_raw_types_pre_java_5">1.1. Raw types, pre-Java 5</a></li>
<li><a href="#_generic_types_the_modern_way">1.2. Generic types, the modern way.</a></li>
<li><a href="#_exercise_generic_box">Exercise Generic Box</a></li>
<li><a href="#_cheating_the_compiler">1.3. Cheating the compiler</a></li>
<li><a href="#_type_token">1.4. Type token.</a></li>
</ul>
</li>
<li><a href="#_wildcard_and_bounds">2. Wildcard and bounds.</a>
<ul class="sectlevel2">
<li><a href="#_unbound_wildcard">2.1. Unbound wildcard.</a></li>
<li><a href="#_upper_bound_or_covariant">2.2. Upper bound or Covariant</a></li>
<li><a href="#_lower_bound_or_contra_variant">2.3. Lower bound or Contra variant</a></li>
<li><a href="#_bounds_explained">2.4. Bounds explained.</a></li>
<li><a href="#_exercise_shapefilter">Exercise Shapefilter</a></li>
</ul>
</li>
<li><a href="#_self_use_in_generic_definitions">3. Self use in Generic definitions</a></li>
<li><a href="#_testing_generics">4. Testing generics</a>
<ul class="sectlevel2">
<li><a href="#_exercise_generic_ranges_part_1">Exercise Generic Ranges part 1</a></li>
</ul>
</li>
<li><a href="#_design_for_extension_and_reusing_generics_tests">5. Design for Extension and Reusing Generics Tests.</a>
<ul class="sectlevel2">
<li><a href="#_exercise_generic_ranges_2_adding_tests_and_leafs">Exercise Generic Ranges 2: Adding tests and Leafs</a></li>
</ul>
</li>
<li><a href="#_reading">Reading</a></li>
<li><a href="#_slides">Slides</a></li>
<li><a href="#_exercises_in_this_part">Exercises in this part</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<table id="main-menu" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8823%;">
<col style="width: 5.8832%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="index.html" title="Home">TOP</a></p></td>
<th class="tableblock halign-left valign-top"><p class="tableblock">week</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="week01.html" title="What is TDD">01</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="week02.html" title="Parameterized Tests">02</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="week03.html" title="Testability and Mockito">03</a></p></td>
<th class="tableblock halign-left valign-top"><p class="tableblock"><a href="week04.html" title="Generics">04</a></p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="week05.html" title="Lambdas and Streams">05</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="week06.html" title="Reflection">06</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="week07.html" title="Java Database Access">07</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="week08.html" title="Java FX Bindings and Java Module System">08</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="week09.html" title="Statemachines and Regex">09</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="week10.html" title="Data Time Api anmd Internationalization">10</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="week11.html" title="Exceptions, Assertionas and logging, File IO">11</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="week12.html" title="Security">12</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="setup.html" title="Setup your System">SETUP</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="tips.html" title="Tips Through the Weeks">TIPS</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="assessmentcorrectionrules.html" title="Performance Assessment">PA</a></p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p><strong class="big"><a href="../reports/2021/index.php">You can find your home work tests here</a></strong></p>
</li>
<li>
<p><strong class="big"><a href="https://peerweb.fontysvenlo.org/igrouprepos.php" target="_blank" rel="noopener">Your personal repositories on fontys venlo </a>.</strong></p>
</li>
<li>
<p><strong class="big"><a href="../reports/2021/pdf/PRC2-planning-202106014.pdf" target="_blank" rel="noopener">Assessment schedule </a></strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="big">Generics is mainly a compiler feature. In java (at least the versions up to this moment, January 2021) it
is even more so, because after the compiler had it&#8217;s go with it, it largely discards the generic information, and the runtime, the JVM,
does not really care about generics and does not use it. The role of generics is to keep the programs type-safe.
The compiler will check that a use of a method, field, or class complies with its definition,
and if the use does <strong class="red">not</strong>, the compiler will produce an <strong class="red">error</strong>, to prevent the programmer from doing unsafe things.</span></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_generics_the_fine_print"><a class="anchor" href="#_generics_the_fine_print"></a><a class="link" href="#_generics_the_fine_print">1. Generics, the fine print</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Generics were introduced in Java 5.</p>
</div>
<div class="paragraph">
<p>Generics help keeping the language safer by giving the compiler more ways to <em>reason</em>
about the code and reject it when it is bad. That is what a strictly typed language is all about.</p>
</div>
<div class="paragraph">
<p>With generics also <strong>auto-boxing</strong> was introduced. The concept was borrowed from <strong>C#</strong> and the dot-net framework.
Auto-boxing is auto-magically converting/wrapping an <code>int</code> into an <code>Integer</code> (auto-box) when a
reference type is needed and backwards when the reference type Integer is given and an <code>int</code> is needed (auto-unboxing).
This makes primitive types to play 'nicely' with generics to some degree.</p>
</div>
<div class="paragraph">
<p>Generics also helps avoiding code duplication, because you can have a <em>something</em> of <em>anything</em>
like a <code class="blue">List</code> of <code class="blue">Student</code> without any code duplication or any code generation under the hood, to create
specialized classes per anything type.<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup>
So this <strong class="blue">List</strong> exists once and is just as applicable to Student as is to Donkey.
This applies to reference types, not yet to primitive types. That may come in a future version of Java under the banner of project
<a href="https://openjdk.java.net/projects/valhalla/" target="_blank" rel="noopener">valhalla </a>.</p>
</div>
<div class="paragraph">
<p>A strong point of Java has always been the preservation of investment (in code). What worked once should still work.
So code that was legal (and compiled) in the Java 1.1 era should still run, even if used today in its binary format. Heck, in closed
source stuff that might be the only form you have, but your investment is preserved because of this backwards compatibility.</p>
</div>
<div class="paragraph">
<p>This strong point has a flip side. Pré Java 5 does not understand generics, which would break the backwards compatibility. That
is why the generic info, after being used by the compiler for correctness verification is then thrown away by the same compiler. Little
if anything of the generic information is preserved for the run time. As a matter of fact, the JVM has no notion of generics, nor does it
need it to function. This has all kind of consequences.</p>
</div>
<div class="paragraph">
<p>In modern Java code, in particular since Java 8 with Functional interfaces and Streams, generics are a <strong>must</strong>, because the provide safety in the one hand
and the required flexibility in the other, required to make the Java 8 features possible at all.</p>
</div>
<div class="sect2">
<h3 id="_raw_types_pre_java_5"><a class="anchor" href="#_raw_types_pre_java_5"></a><a class="link" href="#_raw_types_pre_java_5">1.1. Raw types, pre-Java 5</a></h3>
<div class="paragraph">
<p>The pre-java 5 days did not have generics. All types that have been generified since then still exist in their original,
nowadays called <strong class="blue">raw</strong> form. From the above you can infer that this is what the JVM sees and uses.</p>
</div>
<div class="listingblock">
<div class="title">Using a map in pre Java 5 times</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">   <span class="predefined-type">Map</span> studentsMap = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>(); <i class="conum" data-value="1"></i><b>(1)</b>

   studentsMap.put( <span class="predefined-type">Integer</span>.valueOf( <span class="integer">313581</span> ) ,<span class="keyword">new</span> Student( <span class="string"><span class="delimiter">&quot;</span><span class="content">Potter</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">Harry</span><span class="delimiter">&quot;</span></span> ) );

   <span class="comment">// some time later</span>
   Student harry = (Student) studentsMap.get(<span class="predefined-type">Integer</span>.valueOf( <span class="integer">313581</span> ) ); <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The map has no clue about of the types of key or value, so Object is the best it can do.<br>
Also note that you had to turn the <code>int</code> into an <code>Integer</code> object manually, because auto-boxing did not exist.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Retrieving the object from a map is again wrapping the <code>int</code> and also <em>cast</em> the object back to the expected type.</td>
</tr>
</table>
</div>
<div class="imageblock related thumb right"">
<div class="content">
<a class="image" href="https://emojipedia.org/ghost/"><img src="./images/ghost_1f47b.png" alt="ghost 1f47b"></a>
</div>
<div class="title">Figure 1. Dementor</div>
</div>
<div class="paragraph">
<p>In the above pieces of code all kinds of things can go wrong. You could put any pair of objects of any type in the map and the compiler
had no way of checking what you did made sense. In a <em>Hogwarts</em> narative:  You might have put a benign wizard in your map,
only to get haunted by a <a href="https://en.wikipedia.org/wiki/Magical_creatures_in_Harry_Potter#Dementors" target="_blank" rel="noopener">Dementor </a>
on retrieval.</p>
</div>
</div>
<div class="sect2">
<h3 id="_generic_types_the_modern_way"><a class="anchor" href="#_generic_types_the_modern_way"></a><a class="link" href="#_generic_types_the_modern_way">1.2. Generic types, the modern way.</a></h3>
<div class="listingblock">
<div class="title">example lists and maps</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">   <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; l1 = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;();
   <span class="predefined-type">List</span>&lt;Student&gt; stuList = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;();
   <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>,BiFunction&lt;<span class="predefined-type">Double</span>,<span class="predefined-type">Integer</span>,<span class="predefined-type">Integer</span>&gt;&gt; operatorMap;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The thing is that the compiler is very finicky. It should be, very precise and meticulous.
As an example, say you have a simple person hierarchy: Person is extended by Student.</p>
</div>
<div class="listingblock">
<div class="title">some regular people in lists.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">class</span> <span class="class">Person</span>{}
<span class="type">class</span> <span class="class">Student</span> <span class="directive">extends</span> Person{}

<span class="comment">// in some code</span>
    <span class="type">void</span> m(){
      Person paul = ....
      Student serena = ...
      List&lt;Person&gt; pl;
      <span class="predefined-type">List</span>&lt;Student&gt; sl;

    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The compiler will allow you to do <code>pl.add(serena)</code>, and <code>sl.add(serena)</code> because serena is a <code>Student</code> and by extension a <code>Person</code>, but
paul can&#8217;t be added to <code>sl</code>, because as far as the compiler is concerned, paul is not a Student and 'would not fit'.</p>
</div>
<div class="paragraph">
<p><span class="big green">What the compiler tries to achieve is that if you define a collection to contain students, then it promises
that only students will go in and will ever come out. It does that by checking and not accepting any potential violation of the promise.</span></p>
</div>
<div class="paragraph">
<p>By sticking to this promise, the objects you can receive will be of the correct type and you can do what the type allows, like method calls etc.</p>
</div>
</div>
<div class="sect2">
<h3 id="_exercise_generic_box"><a class="anchor" href="#_exercise_generic_box"></a><a class="link" href="#_exercise_generic_box">Exercise Generic Box</a></h3>
<div class='ex'><details open class='ex'><summary class='ex'>Exercise 1: Box of things</summary>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
All your classes must be in the package <span class="blue">boxes</span>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Before you learnt that generics exist, you had to get by. You needed classes
that store information for you and let you retrieve it, too. So after a semester
of Java, you have a bunch of classes in which you store stuff. For example, you have the
class <code>IntegerBox</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Java"><span class="directive">public</span> <span class="type">class</span> <span class="class">IntegerBox</span> {
  <span class="directive">private</span> <span class="predefined-type">Integer</span> value;

  <span class="directive">public</span> <span class="type">void</span> putIntegerInBox(<span class="predefined-type">Integer</span> anInt) {
    value = anInt;
  }
  <span class="directive">public</span> <span class="predefined-type">Integer</span> getInteger() {
    <span class="keyword">return</span> value;
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This little box class is pretty straight-forward. It has an Integer field at
which you store the Integer that you put in the box, and you have a getter
(getInteger) and a setter (putIntegerInBox) method to store and retrieve your
Integers.</p>
</div>
<div class="paragraph">
<p>The trouble is, this box can&#8217;t deal with <code>Double</code>. Or <code>String</code>. Or anything that
is not an Integer. So calling <code>myBox.putIntegerInBox("Text")</code> will not work.
That means that for every new kind of variable, you need a new class. Quickly,
your list of classes grows: <code>IntegerBox</code>, <code>StringBox</code>, <code>DoubleBox</code>, <code>ListBox</code>,
<code>StudentBox</code>, <code>BoxBox</code>&#8230;&#8203; this is very inefficient.</p>
</div>
<div class="paragraph">
<p>This is where you and Java generics come in:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a class named <code>Box</code> that can take <strong>any</strong> type using a <code>type parameter</code>.</p>
</li>
<li>
<p>Inside that class, have a private final field that stores the same <strong>any</strong> type.</p>
</li>
<li>
<p>Constructor that takes the same <strong>any</strong> type</p>
</li>
<li>
<p>Create getter method for the class named: <code>get</code>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Test your implementation by using this main method.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Java"><span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {

   <span class="predefined-type">Box</span>&lt;<span class="predefined-type">Integer</span>&gt; iBox = <span class="keyword">new</span> <span class="predefined-type">Box</span>&lt;<span class="predefined-type">Integer</span>&gt;(<span class="integer">5</span>);
   <span class="predefined-type">Box</span>&lt;<span class="predefined-type">String</span>&gt; sBox = <span class="keyword">new</span> <span class="predefined-type">Box</span>&lt;<span class="predefined-type">String</span>&gt;(<span class="string"><span class="delimiter">&quot;</span><span class="content">Some Text</span><span class="delimiter">&quot;</span></span>);


   <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">My integerBox contains: </span><span class="delimiter">&quot;</span></span>+ iBox.get());
   <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">My stringBox contains: </span><span class="delimiter">&quot;</span></span>+ sBox.get());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To make the exercise complete, also test and implement <code>Box.equals(Object o)`</code> and <code>hashCode()</code>.</p>
</div>
<div class="paragraph">
<p>Next create a class named <code>Pair</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>that can take <strong>two</strong> different type parameters</p>
</li>
<li>
<p>store them in two separate fields (<strong>P</strong> and <strong>Q</strong>)</p>
</li>
<li>
<p>constructor that takes <strong>both</strong> types</p>
</li>
<li>
<p>getters for both types (<code>getP</code> and <code>getQ</code>)</p>
</li>
<li>
<p>Also test and implement equals and hashCode.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Test your implementation by using this main method.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Java"><span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {

   Pair&lt;<span class="predefined-type">String</span>,<span class="predefined-type">Integer</span>&gt; box = <span class="keyword">new</span> Pair&lt;&gt;(<span class="string"><span class="delimiter">&quot;</span><span class="content">Test</span><span class="delimiter">&quot;</span></span>, <span class="integer">4</span>);


   <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">My String contains: </span><span class="delimiter">&quot;</span></span>+ box.getP());
   <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">My Integer contains: </span><span class="delimiter">&quot;</span></span>+ box.getQ());
}</code></pre>
</div>
</div>
</details></div><!--end ex 4-->
</div>
<div class="sect2">
<h3 id="_cheating_the_compiler"><a class="anchor" href="#_cheating_the_compiler"></a><a class="link" href="#_cheating_the_compiler">1.3. Cheating the compiler</a></h3>
<div class="paragraph">
<p>You can trick the compiler into breaking its promises. In the end, of course the compiler is not the victim, but the program is.
It will generate a <span class="red">ClassCastException</span> on retrieval of the non-fitting object. And as programs go when they generate uncaught exceptions:
they will be aborted by the JVM.</p>
</div>
<div class="listingblock">
<div class="title">Sneaky code. Do not do this at home. You are only fooling yourselves.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main( <span class="predefined-type">String</span><span class="type">[]</span> args ) {
        <span class="predefined-type">List</span>&lt;Student&gt; sl = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;Student&gt;();
        sl.add( <span class="keyword">new</span> Student( <span class="string"><span class="delimiter">&quot;</span><span class="content">Hermione</span><span class="delimiter">&quot;</span></span> )); <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="predefined-type">List</span> ol = (<span class="predefined-type">List</span>) sl;                <i class="conum" data-value="2"></i><b>(2)</b>
        ol.add( <span class="keyword">new</span> Person(<span class="string"><span class="delimiter">&quot;</span><span class="content">Voldemort</span><span class="delimiter">&quot;</span></span>) );  <i class="conum" data-value="3"></i><b>(3)</b>

        <span class="comment">// somewhere else in the scenario</span>
        Student hermione = sl.get( <span class="integer">0</span> );       <i class="conum" data-value="4"></i><b>(4)</b>
        Student lilly = sl.get( <span class="integer">1</span> );        <i class="conum" data-value="5"></i><b>(5)</b>
        <span class="predefined-type">System</span>.out.println( <span class="string"><span class="delimiter">&quot;</span><span class="content">lilly = </span><span class="delimiter">&quot;</span></span> + lilly ); <i class="conum" data-value="6"></i><b>(6)</b>
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>accepted.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>give the compiler a raw alias.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>so it will gladly accept this. You <span class="red">cheated!</span></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>no sweat, our heroine pops out,</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>but the other object will make your program fail at this statement with a <code class="red">ClassCastException</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Statement never reached because your program will have been <mark>terminated</mark> by now.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_type_token"><a class="anchor" href="#_type_token"></a><a class="link" href="#_type_token">1.4. Type token.</a></h3>
<div class="paragraph">
<p><span class="image thumb right"><img src="./images/towerguard.png" alt="towerguard" width="140px" title="guards guards"></span>
Sometimes you have a problem, which can only be solved by explicitly providing the generic information to
the code at run-time. This use is called 'providing a type-token'.<br>
An example of such use is the method <a href="file:///usr/share/doc/openjdk-11-doc/docs/api/java.base/java/util/Collections.html#checkedList(java.util.List,java.lang.Class)">Collections.checkedList( &lt;List&lt;E&gt;, Class&lt;E&gt; type )</a>,<br>
whose usage example is <code>List&lt;Student&gt; studList = Collections.checkedList( students, Student.class )</code>.<br>
The type token will play the role of a <strong class="blue">sentinel</strong> or <strong class="blue">guard</strong>, because all class object have a <code>cast</code> method that check if the cast is legal, and if it is,
applies the cast to the incoming object; if not it will throw a <span class="red">ClassCastException</span>.
This will prevent even the sneakiest code, including code predating Java 5 and the code above, to sneak in an none-student object.
This guard will also throw an exception, and actually the same one, but now at the side of the culprit, because the exception will be thrown at insertion.
You should not do this as normal usage, because the check on every insertion goes with a cost (CPU cycles), but it can be helpful to detect problems caused
by some naughty code, because now a violation against the promise will result in an exception at run-time,
a <code>ClassCastException</code> to be exact at the moment of insertion, so any sneaky code can be caught <em class="red">red-handed</em>,
leaving a nice big stack trace as a trail for all to see.</p>
</div>
<div class="paragraph">
<p>There are other uses of type-tokens, which you may see later in the course.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_wildcard_and_bounds"><a class="anchor" href="#_wildcard_and_bounds"></a><a class="link" href="#_wildcard_and_bounds">2. Wildcard and bounds.</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Read Horstmann section 8.8.</p>
</div>
<div class="paragraph">
<p>With the definition in the previous paragraphs, you are losing some flexibility, compared to raw types. In particular, you may want
to insert (and retrieve) sub types of a class into or retrieve from a collection.</p>
</div>
<div class="paragraph">
<p>Using wildcards and bounds will give back some of the flexibility while still upholding type-safety.
The wildcard has been given the character symbol <strong class="bold">'?'</strong>, the question mark.</p>
</div>
<div class="sect2">
<h3 id="_unbound_wildcard"><a class="anchor" href="#_unbound_wildcard"></a><a class="link" href="#_unbound_wildcard">2.1. Unbound wildcard.</a></h3>
<div class="paragraph">
<p>The unbound wildcard is something that should be used sparingly. The best example in the new definition of the Class type.
In pre -5 times that was <code>Class someClass</code> that is a raw class, nowadays it is <code>Class&lt;?&gt; someClass</code> which actually sounds as a class of any kind.
There is little difference but the compiler will be nicer to you. There are some corner cases where you can&#8217;t avoid it and then the form using the wildcard
is the correct choice.</p>
</div>
</div>
<div class="sect2">
<h3 id="_upper_bound_or_covariant"><a class="anchor" href="#_upper_bound_or_covariant"></a><a class="link" href="#_upper_bound_or_covariant">2.2. Upper bound or Covariant</a></h3>
<div id="supers" class="imageblock">
<div class="content">
<img src="./images/acceptablesupers.svg" alt="acceptablesupers">
</div>
<div class="title">Figure 2. Hierarchy of shapes, assume mathematical shapes, so a line has no width and hence no surface area. Nor does an arc.</div>
</div>
<details class="quiz">
<summary class="title">Quiz: Can you name the super types of circle in the class diagram above?</summary>
<div class="content">
<div class="paragraph">
<p>Shape, Object, Serializable, ArcLike, Surface, and Circle itself.</p>
</div>
</div>
</details>
<div class="paragraph">
<p>When you intend to write code with high flexibility, in particular when you use inheritance as in <span class="blue">extends</span> and <span class="blue">implements</span>,
then there are a few rules to apply to your generic code. It all has to do with what a container, defined with generic types should <em>accept</em> or will <em>produce</em>.</p>
</div>
<div class="paragraph">
<p>We will refer to the picture above. We have two scenarios:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A class that makes or <em>supplies</em> shapes. Imagine reading the shape definitions from a drawing file with vector graphics.</p>
</li>
<li>
<p>A class that should accept shapes, like a canvas on which you can draw.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The supplier or <strong>Producer</strong> as it is called in the documentation, could be some collection such as a <em>list</em> of any of the types in the class diagram:
<code>Object</code>, <code>Serializable</code> (that is probably how the Objects were read from disk), but the most likely and useful would be the <code>Shape</code> type.</p>
</div>
<div class="listingblock">
<div class="title">Passing things to be drawn to the canvas.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">  <span class="type">interface</span> <span class="class">Canvas</span> {
    <span class="type">void</span> draw( <span class="predefined-type">List</span>&lt;<span class="predefined-type">Shape</span>&gt; shapes ); <i class="conum" data-value="1"></i><b>(1)</b>
  }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>as far as the draw method is concerned, the list <em>produces</em> the shapes to be drawn.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now imagine that you have a list of circles: <code>List&lt;Circle&gt; circles = new ArrayList&lt;&gt;()</code>. Then the above definition of the <code>Canvas.draw()</code> method
forbids you to do <code>canvas.draw( circles );</code>, which is quite counter-intuitive, because the class diagram and the code says that a Circle is a Shape.
The compiler will say: '<em>incompatible types: List&lt;Circle&gt; cannot be converted to List&lt;Shape&gt;</em>'.</p>
</div>
<div class="paragraph">
<p>This is because, although a <code>Circle</code> is a sub-class of <code>Shape</code>, a <code>List&lt;Circle&gt;</code> is <span class="red">NOT</span> a sub-class of <code>List&lt;Shape&gt;</code>. This is not a Java feature but
a problem addressed with Type Theory which is beyond the topics of this course.<br>
To amend this problem, you must change the definition of the draw method so that it accepts shapes but also
any derived type. You do that by adding the wild-card which expresses anything (within limits or bounds).</p>
</div>
<div class="listingblock">
<div class="title">Flexible shape that also accepts lists of sub-classes of Shape.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">  <span class="type">interface</span> <span class="class">Canvas</span> {
    <span class="type">void</span> draw( <span class="predefined-type">List</span>&lt;? <span class="directive">extends</span> <span class="predefined-type">Shape</span>&gt; shapes ); <i class="conum" data-value="1"></i><b>(1)</b>
  }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This accepts Shape but also anything that is a sub type of Shape, so Circles, Triangles, Lines etc.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This makes the draw method more flexible and reusable, because the draw method can draw any shape now. Type theory calls this kind
of relation between Shape and List of Shape <strong>Covariant</strong>. They both develop in the same direction, so semantically a <code>List&lt;? extends Shape&gt;</code> is covariant with
<code>Circle extends Shape</code>. You could say, both extend <em>down</em> and therefor there is an upper bound, <code>Shape</code> in the example.</p>
</div>
</div>
<div class="sect2">
<h3 id="_lower_bound_or_contra_variant"><a class="anchor" href="#_lower_bound_or_contra_variant"></a><a class="link" href="#_lower_bound_or_contra_variant">2.3. Lower bound or Contra variant</a></h3>
<div class="paragraph">
<p>Now imagine that you have a method in some other class that wants to collect Shapes in a collection like a List.
In the documentation such list, which should accept objects, would be called a <strong>Consumer</strong>.</p>
</div>
<div class="listingblock">
<div class="title">Passing a container that should receive/consume collected shapes.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">  <span class="type">class</span> <span class="class">Collector</span> {
    <span class="comment">// objects are added to be added to receiver or consumer</span>
    <span class="type">void</span> collect( <span class="predefined-type">List</span>&lt;Circle&gt; receiver ){ <i class="conum" data-value="1"></i><b>(1)</b>
      Circle c =...
      receiver.add( c ); <i class="conum" data-value="2"></i><b>(2)</b>
    }
  }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Too strict</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Problematic line when widening 1 with extends.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Again, the compiler will complain if you call collect with your list of Circles as input.
Use case: you want to tally up the total area covered by circles.</p>
</div>
<div class="paragraph">
<p>This time it says the same thing on the call statement <code>collector.collect(circles)</code>. Let&#8217;s apply the same solution as above.
If we define the collect method like <code>void collect( List&lt;? extends Circle&gt; receiver )</code>, the compiler will not complain on this line, but
on the line <code>receiver.add( c );</code> with a nasty curse:</p>
</div>
<div class="listingblock">
<div class="title">Compiler complaint.</div>
<div class="content">
<pre class="CodeRay highlight"><code>incompatible types: Circle cannot be converted to CAP#1
  where CAP#1 is a fresh type variable:
    CAP#1 extends Shape from capture of ? extends Shape</code></pre>
</div>
</div>
<div class="paragraph">
<p>So <code>extends</code> is not the way to go. You could infer that the list should be defined such that it accepts the Circle but also any type
that circle extends or, from the stand point of the circle, a super type of Circle. You are actually  saying that circle and any of its super types will
be acceptable to the receiver. Circle is the <strong>lower bound</strong> in the example.</p>
</div>
<div class="listingblock">
<div class="title">Super, that does it.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">class</span> <span class="class">Collector</span> {
    <span class="comment">// objects are added to receiver</span>
      <span class="type">void</span> collect( <span class="predefined-type">List</span>&lt;? <span class="local-variable">super</span> Circle&gt; receiver ){ <i class="conum" data-value="1"></i><b>(1)</b>
        Circle c =...
        receiver.add( c ); <i class="conum" data-value="2"></i><b>(2)</b>
      }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>super</code> here makes any List of any super type of Circle acceptable to</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the add operation.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>List&lt;? super Circle&gt;</code> in the above example is now contra variant with <code>Circle</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_bounds_explained"><a class="anchor" href="#_bounds_explained"></a><a class="link" href="#_bounds_explained">2.4. Bounds explained.</a></h3>
<div class="paragraph">
<p>The wild card construct with <code>extends</code> or <code>super</code> is called a bounded wild card.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>With <code>extends</code>, which defines the upper-bound, the boundary is the top most type of the acceptable
types, so that that type defines what can be done with it and all its derivatives, like draw().<br>
 <code>extends</code> puts a <strong>upper bound</strong> on the element type.</p>
</li>
<li>
<p>With <code>super</code>, which defines the <strong>lower-bound</strong>, the bound is the bottom-most type of the acceptable types. It defines the receiver
or consumer of the type. Because that lower bound is the sub-most type of the inheritance hierarchy it is <em>it</em> and all above it, which says
that any consumer (receiver) of such super-type will accept the sub-most or lowest type but also any of the super types.<br>
<code class="blue">super</code> puts a bound on what a consumer like a collection, set or list should accept.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>All this bounds stuff is about the direction of the operation, get or put. You can <em>get</em> from a <strong>Producer</strong> and <em>put</em> into a <strong>Consumer</strong>.
The extends bound puts a constraint on the element that are to be produced, the super puts a constraint what the receiver or consumer of the element should accept.<br>
There is a mnemonic for this: <strong class="big">P.E.C.S.</strong>, which says <strong class="big">P</strong>roducer, use <strong class="big">E</strong>xtends, <strong class="big">C</strong>onsumer use <strong class="big">S</strong>uper.<br>
<strong>Note</strong> that put and get both come with other names. For instance, <strong>put</strong> is sometimes called <strong>add</strong>, <strong>push</strong>, or <strong>accept</strong>, according to the naming convention in its context.
Same for <strong>get</strong>, which may answer to the name <strong>pull</strong>, <strong>pop</strong>, <strong>take</strong>, <strong>remove</strong>, etc.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Extends</strong> and covariance is easiest to understand. Contra-variance less so.<br>
As an example for <strong>super</strong>, have a look at the <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/function/Consumer.html" target="_blank" rel="noopener">Consumer </a>
functional interface. There is a default helper method given that specifies that the Consumer named <strong>after</strong> in the <code>andThen(..)</code>
method must be of type <code>Consumer&lt;? super T&gt;</code>,
saying that said consumer must accept Ts, but may also accept any super type of T. And again any consumer that accepts T or any of its super types will do.
You will see this pattern throughout the <code>java.util.function</code> package where a default followup method such as <code>andThen</code> or <code>compose</code> is specified.</p>
</div>
<div class="paragraph">
<p>The last paragraph makes the point why Functional interfaces and all other goodies introduced in Java 8 heavily rely on generics.</p>
</div>
</div>
<div class="sect2">
<h3 id="_exercise_shapefilter"><a class="anchor" href="#_exercise_shapefilter"></a><a class="link" href="#_exercise_shapefilter">Exercise Shapefilter</a></h3>
<div class='ex'><details open class='ex'><summary class='ex'>Shape Filter</summary>
<div class="paragraph">
<p><strong>Shape Filters</strong>
The shapes project template is in your repository.</p>
</div>
<div class="paragraph">
<p>In package <code>shapes.basic</code> you have multiple shapes, among which are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Disk</strong> which extends Circle. Disk contains an image.</p>
</li>
<li>
<p><strong>Sphere</strong> which extends Disk. Sphere creates a 3D like image of a sphere or Ball.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The essential detail here is that Disk and Sphere are sub classes of Circle.
There is no need to change anything in this package. Just check if you
understand the inheritance hierarchy and the use of interfaces and abstract
classes.</p>
</div>
<div class="paragraph">
<p><strong>Shape filter</strong>
This part is about generics. Remember the PECS acronym. In the ShapeManager
test-driven develop two methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>void addShapes(List&lt;&#8230;&#8203;&gt; shapesToAdd)</code> Make sure to use the proper
list definition with generics. The idea is that each list of
shapes (e.g. a list of Circles, a list of Disks, a list
of Shapes can be processed).</p>
</li>
<li>
<p><code>boolean collectShapesOfType( Collection&lt;&#8230;&#8203;&gt; consumer, Class&lt;&#8230;&#8203;&gt; type )</code> This method takes two arguments,
(1) a list (like a list) in which you can put shapes and (2) the type of shape
you want to filter. For example, you’re passing an empty list that is filled
with all Circles.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The learning goal in the exercise is to get the generics write, almost a fill in the dots in the methods above.
Of course the declaration must be correct on both call-site (where you call the method) and at the method site.</p>
</div>
<div class="paragraph">
<p>Using raw types is certainly wrong.</p>
</div>
</details></div> <!-- end shape filter -->
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Generics and arrays, including varargs are not an optimal combination, because you can&#8217;t create generic arrays.
When you pass a generic varargs array to a method, the compiler may generate a warning along the line of <mark>Possible heap pollution for vararg type Y</mark>
for a method declared as  <code>static &lt;Y extends Comparable&lt;? super Y&gt;&gt; Y[] minmax( Y&#8230;&#8203; a )</code>.
Only put a <code>@SafeVarargs</code> annotation on a method using varargs, after when you have ensured yourselves that the use of the generic parameter in the
method does not throw a <code class="red">ClassCastException</code>.</p>
</div>
<div class="paragraph">
<p>By the same token, don&#8217;t fool yourselves by putting <code class="blue">@SuppressWarnings("unchecked")</code> in all places where you see a warning flag saying you are using a raw type.
Correct the use of the type or at least use the wildcard like <code>List&lt;?&gt;</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_self_use_in_generic_definitions"><a class="anchor" href="#_self_use_in_generic_definitions"></a><a class="link" href="#_self_use_in_generic_definitions">3. Self use in Generic definitions</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Generics is not only applicable for collections, although that aspect of the standard Java library is a big customer of this
language feature. But it can be used in other places too, as you have seen in the functional interfaces which define the <strong>shape</strong> of lambda expressions.</p>
</div>
<div class="paragraph">
<p>You may have come across a generic type definition that looks a bit weird as in, the type is used in its own definition.
An example of that is the definition of the
 <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/Enum.html">Enum class</a>,
 which the abstract super class of all <strong class="blue">enums</strong>:</p>
</div>
<div class="listingblock">
<div class="title">Enum class definition, a bit of a mouth-full.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">Enum</span>&lt;E <span class="directive">extends</span> <span class="predefined-type">Enum</span>&lt;E&gt;&gt;
        <span class="directive">implements</span> <span class="predefined-type">Comparable</span>&lt;E&gt;, <span class="predefined-type">Serializable</span> {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This definition puts bounds or constraints on the type E, which must hence be a sub type (sub class) of <code>Enum</code> itself.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <em>type declaring keywords</em> in Java are <span class="blue">class</span>, <span class="blue">interface</span>, and since Java 5 <span class="blue">enum</span>. Java 14 introduced <span class="blue">record</span>,
which looks a lot like enum in the technique of its definition. It makes an <span class="blue">enum</span> and a <span class="blue">record</span> final, but they can implement interfaces.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Another one is in the use of <code>Comparable</code>, like in the <code>String</code> class,
it says among others <code>String implements Comparable&lt;String&gt;</code>, to make Strings comparable to each other, but not to other types.
Again a bound or constraint of types, in the example the parameter of the <code>int compareTo(T)</code> method declared in Comparable.</p>
</div>
<div class="paragraph">
<p>Let us make a simple and silly but instructive example: A zoo.
We want it to be such that a class inherits all the traits of its super,
and we want to be able to use it in a <em>fluent</em> style of programming.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/zoo.svg" alt="zoo">
</div>
<div class="title">Figure 3. Mini zoo</div>
</div>
<div class="paragraph">
<p>In our programs we want to express things like <code>donald.fly().swim().walk()</code>,
which is a common sequence of operations for ducks. We want each of the methods
in the chain to return the duck, so that Donald can do his operations in any order he likes.</p>
</div>
<div class="paragraph">
<p>This is also understood by the IDE, which will show <em>completions</em> fitting for the duck when the object is a <code>Duck</code>.
For the <code>Bird</code> class on the other hand, the IDE will not <em>complete</em> with <code>swim()</code>, and for the <code>Penguin</code> not with <code>fly()</code>.</p>
</div>
<div class="paragraph">
<p>To make this work, you need to make your classes as you could say <em>self-aware</em>.
It means that the class in the hierarchy defines a method called <code>self()</code> whose return type is that of the class, not one of the super types.
The self-use in the generics declaration makes this work, in combination with the fact that
 each <em class="green">leaf class</em> <sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup>
 has a <code>self()</code> method which, through convincing the compiler with generics, returns an object of the correct type.
In the definition of each leaf class, the leaf class itself is the type parameter, like in <code>Penguin implements Bird&lt;Penguin&gt;, Swimmer&lt;Penguin&gt;</code> etc.
In particular, it is <strong class="red">not</strong> parameterized any further such as <code>Penguin&lt;P&gt;</code>, because they themselves are the desired final type or leaf types.</p>
</div>
<div class="paragraph">
<p>If you want a non-leaf (abstract) class or interface, your have to further use the self reference in the generic definition.</p>
</div>
<div class="listingblock">
<div class="title">EBird is an extendable Bird</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">EBird</span>&lt;EB <span class="directive">extends</span> EBird&lt;EB&gt;&gt;  <span class="directive">extends</span> Flyer&lt;EB&gt;, Walker&lt;EB&gt;{

     EB afterBurner(){
         <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">VROOOAAAR</span><span class="delimiter">&quot;</span></span>);
         <span class="keyword">return</span> self();
     }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Thunderbird is it&#8217;s child.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ThunderBird</span> <span class="directive">implements</span> EBird&lt;ThunderBird&gt;{
    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main( <span class="predefined-type">String</span><span class="type">[]</span> args ) {
        ThunderBird tb = <span class="keyword">new</span> ThunderBird();
        tb.fly().move().walk().fly().brood().fly().afterBurner();
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<span class="image thumb right"><img src="./images/LeafFarket.png" alt="LeafFarket" width="100"></span>
A leaf class is a concrete class at the bottom of the type hierarchy, which is no longer generic on self. In the current implementation you can&#8217;t extend it easily.
In java <span class="blue">enum</span> and <span class="blue">record</span> types are also all leaf classes, that cannot be extended.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The code below shows what all this looks like for <code>Bird</code> (providing self), <code>Flyer</code>,  and <code>Duck</code>:</p>
</div>
<div class="listingblock">
<div class="title">Animals can move and are self aware.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">zoo</span>;

<span class="directive">public</span> <span class="directive">abstract</span> <span class="type">interface</span> <span class="class">Animal</span>&lt;A <span class="directive">extends</span> Animal&lt;A&gt;&gt; {

    <span class="keyword">default</span> A move() {
        <span class="predefined-type">System</span>.out.println( <span class="string"><span class="delimiter">&quot;</span><span class="content">twitch </span><span class="delimiter">&quot;</span></span> );
        <span class="keyword">return</span> self();
    }

    <span class="keyword">default</span> A brood() {
        <span class="predefined-type">System</span>.out.println( <span class="string"><span class="delimiter">&quot;</span><span class="content">cosy with my offspring </span><span class="delimiter">&quot;</span></span> );
        <span class="keyword">return</span> self();
    }

    <span class="comment">// makes object self aware.</span>
    <span class="keyword">default</span> A self() {
        <span class="keyword">return</span> (A) <span class="local-variable">this</span>;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The common trait of animals is that they can move. It is in the name. Even coral can move, if not very far.</p>
</div>
<div class="listingblock">
<div class="title">Flyer adds flying functionality.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">zoo</span>;

<span class="directive">public</span> <span class="type">interface</span> <span class="class">Flyer</span>&lt;F <span class="directive">extends</span> Flyer&lt;F&gt;&gt; <span class="directive">extends</span> Animal&lt;F&gt; {

    <span class="keyword">default</span> F fly() {
        <span class="predefined-type">System</span>.out.println( <span class="string"><span class="delimiter">&quot;</span><span class="content">swoosh</span><span class="delimiter">&quot;</span></span> );
        <span class="keyword">return</span> self();
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Ducks are Animals with many traits, all inherited, and little work. You might think ducks are lazy. &#x1F986; &#128522;</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">zoo</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">Duck</span> <span class="directive">implements</span>  Flyer&lt;Duck&gt;, Swimmer&lt;Duck&gt;, Walker&lt;Duck&gt; {

}</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">you know it is just a model, think movies &#8230;&#8203;</div>
<p><span class="image thumb left"><img src="./images/duckling.jpg" alt="duckling" width="150"></span>
The Duck class above is the complete concrete leaf class, nothing has been left out. Everything is in the supers (the interfaces in this case), generics is
just the thread that stitches the Duck together.</p>
</div>
<div class="paragraph">
<p>This all provides the most benefit in Java 8 and up, because from Java 8 interfaces can have <span class="blue">default</span> and <span class="blue">static</span> methods,
thereby implementing things, based on the abstract methods the implementing class must provide, as is the case with <code>self()</code>. And even self() is generified out
by way of convincing the compiler that the default implementation does the trick. <strong class="green">Minimal code with maximum effect</strong>.</p>
</div>
<div class="paragraph">
<p>The techniques described here are heavily used in the <a href="https://assertj.github.io/doc/">AssertJ</a> library.
The details of this SELF use can be found <a href="https://web.archive.org/web/20130721224442/http:/passion.forco.de/content/emulating-self-types-using-java-generics-simplify-fluent-api-implementation" target="_blank" rel="noopener">here </a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_testing_generics"><a class="anchor" href="#_testing_generics"></a><a class="link" href="#_testing_generics">4. Testing generics</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>As explained, generics is mainly used at the source code level and compiler to check the program for correct use of the declared types and methods.
As such, testing of the generic aspect of your code is done when your compiler is happy with it AND you have expressed your real intent. Sometimes the last
part is the trickiest.</p>
</div>
<div class="paragraph">
<p>On the other hand generics allows you to create a super type, ( super <span class="blue">class</span> or <span class="blue">interface</span> ), that pulls most of the work,
as the little zoo example already hinted towards.</p>
</div>
<div class="paragraph">
<div class="title">make it super</div>
<p><span class="image thumb left"><img src="./images/Superman_shield.png" alt="Superman shield" width="200"></span>
In the zoo example you go from the abstract (super type animal) and interfaces (Flyer and the lot) to the concrete Penguin and Duck.
For a student that studies Software Design, in particular <a href="https://en.wikipedia.org/wiki/Software_design_pattern">Design Patterns</a>,
that smells like a potential application of the <a href="https://en.wikipedia.org/wiki/Abstract_factory_pattern">Abstract Factory</a> Pattern.
Indeed, the case of testing is one.</p>
</div>
<div class="paragraph">
<p>If you are designing such a super type with concrete methods (in the <span class="blue">abstract class</span> or <span class="blue">default</span> or <span class="blue">static</span> methods in the <span class="blue">interface</span>)
you will want to develop this in a super test driven way. Always remember that the most important rule in TDD is tiny steps, to prevent falling off the track.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong class="big">You don&#8217;t need a (<span class="blue">public</span>) constructor.</strong><br>
You will notice that the <code class="blue">IntegerRange</code> and <code class="blue">LongRange</code> classes in
the exercise below have <strong class="red">no</strong> public constructor. That is fine.
The style is similar to what <code>LocalDate</code> and friends in the <code>java.time</code> package do.
It can be quite useful to not have a public constructor.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For one, the static factory methods can have <strong>names</strong>,
which allow you to choose something meaningful, if this factory is special.
Or it can have a <em>short</em> name, as you have seen in the Fraction exercise. Or <strong>'of'</strong>
in the example classes and in e.g. <code>LocalDate</code>.</p>
</li>
<li>
<p>It also provides more control over the created instances.</p>
</li>
<li>
<p>It prevents subclassing, if the only constructors you have are private ones.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>To support the case</strong>: You will see that the <strong class="blue">public</strong> constructors of the
Wrapper classes such as Integer and Long are
already deprecated since Java 9 and are about to be removed in some future version of Java, as is evident
for the @Deprecated annotations since java 16.
That could very well be in Java 17. We&#8217;ll see.</p>
</div>
<div class="listingblock">
<div class="title">from the java.lang.Integer source, i.e. Java 16</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="comment">/**
     * Constructs a newly allocated {@code Integer} object that
     * represents the specified {@code int} value.
     *
     * @param   value   the value to be represented by the
     *                  {@code Integer} object.
     *
     * @deprecated
     * It is rarely appropriate to use this constructor. The static factory
     * {@link #valueOf(int)} is generally a better choice, as it is
     * likely to yield significantly better space and time performance.
     */</span>
    <span class="annotation">@Deprecated</span>(since=<span class="string"><span class="delimiter">&quot;</span><span class="content">9</span><span class="delimiter">&quot;</span></span>, forRemoval = <span class="predefined-constant">true</span>) ) <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="directive">public</span> <span class="predefined-type">Integer</span>(<span class="type">int</span> value) {
        <span class="local-variable">this</span>.value = value;
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Announced forRemoval since java 16.</td>
</tr>
</table>
</div>
</td>
</tr>
</table>
</div>
<hr>
<div class="sect2">
<h3 id="_exercise_generic_ranges_part_1"><a class="anchor" href="#_exercise_generic_ranges_part_1"></a><a class="link" href="#_exercise_generic_ranges_part_1">Exercise Generic Ranges part 1</a></h3>
<div class='ex'><details open class='ex'><summary class='ex'>Generic Ranges Part 1</summary>
<div class="paragraph">
<p>A <strong>range</strong> is a mathematical concept with quite a few applications in software systems.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Availability of a person or resource according to some agenda.</p>
</li>
<li>
<p>Booking resources like rooms in hotels or renting cars in a holiday.</p>
</li>
<li>
<p>Computing prices of an arrangement or rent when it crosses different price-zones,
like top-season or low-season.</p>
</li>
<li>
<p>Computer memory inside the computer is a resource to be shared. It also can&#8217;t
overlap in the normal case, in particular not for data segments that are written by a program</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The examples are often related to date or time, and are the most common use.
In the physical 3D world, the simple 1 dimensional linear model of ranges will not always be sufficient.</p>
</div>
<div class="paragraph">
<p>A range is some segment between two points. These points could be points on a number line or on a timeline.
Initially it looks like a simple concept, in particular a number line of say <code>long</code>, but in most physical
cases, the dimension of a <strong>point</strong> differ substantially of that of the distance between two points. To make the case,
you will find it natural to express a point in time as 1995-Aug-12 but you would wonder what exactly 6 * 25 August would mean.</p>
</div>
<div class="paragraph">
<p>This aspect is modeled in the Range <strong class="blue">interface</strong>, the type of the Points is <strong>P</strong>, the dimension between them with <strong>D</strong>. The mnemonic way
to remember is <strong>P</strong> for <strong>p</strong>oint in time, <strong>D</strong> for <strong>D</strong>istance. The <strong>R</strong>ange get the letter <strong>R</strong>.</p>
</div>
<div class="paragraph">
<p>An example of an (important) operation is expressed as a Functional interface called MeasureBetween, which provides the shape of
a lambda expression. <code>(P a, P b) &#8594; D</code>, which says that the method computes the distance <code>D</code> between two <code>Points</code> <code>a</code> and <code>b</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/range-classes.svg" alt="range classes">
</div>
<div class="title">Figure 4. Class diagram of the ranges project</div>
</div>
<div class="paragraph">
<p><strong>Operations.</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Compute the length of a Range as type Distance.</p>
</li>
<li>
<p>Compute the distance between two points.</p>
</li>
<li>
<p>Join and union to join two ranges producing a new Range.</p>
</li>
<li>
<p>Intersection of two ranges, returning the overlap as Range.</p>
</li>
<li>
<p>Divide into parts, such that a range is chopped up into 1, 2 or three parts (Ranges), dependent
on the relative position of the operands in the operation. Useful to make reservations from available date or time ranges.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All tests use a limited set of test values, basically just points, <strong>a</strong>, <strong>b</strong>, <strong>c</strong>, <strong>d</strong>, <strong>e</strong>, and <strong>f</strong>.
These are the same point as used in the diagrams.
A requirement to those points is that they are in ascending order <code class="blue">a &lt; b &lt; c &lt; d &lt; e &lt; f</code>.</p>
</div>
<div class="paragraph">
<p>The ranges project is meant as a reusable library to define some ranges and operations on ranges.
The most important operation in this case is to compute the overlap between to ranges.</p>
</div>
<div id="operations" class="imageblock">
<div class="content">
<img src="./images/rangesoperations.svg" alt="rangesoperations">
</div>
<div class="title">Figure 5. Operations between ranges</div>
</div>
<div class="paragraph">
<p>The <strong>contained</strong> case is interesting one, because it can be used to determine if an availability matches a request.
For instance you want a 3 day holiday and the rooms that you can book must have a free range that contains your request.
If you then book, the free range is then cut up into a (optional) free part <em>before</em>, your booking, and an (optional) free part <em>after</em>.</p>
</div>
<div id="cutter" class="imageblock">
<div class="content">
<img src="./images/rangecutter.svg" alt="rangecutter">
</div>
<div class="title">Figure 6. The cutter cuts red and blue and takes green as a whole</div>
</div>
<div class="paragraph">
<p>The intersection operation in the ranges package is called <code>Range.intersectWith( Range other )</code> and is defined
<em>and</em> implemented in the Range interface as a <span class="blue">default</span> method.
Because the Range interface is defined as a Generic type, the implementing classes can use the <code>intersectWith</code> method without change.</p>
</div>
<div class="paragraph">
<p>The same applies to methods <code>boolean overlaps(Range other)</code> and <code>D overlap(Range other)</code> which test if there <span class="blue">is</span> an overlap and
measure the length of such overlap.</p>
</div>
<div class="paragraph">
<p>The <code>Range intersectWith(Range other)</code> can be used to find conflicting ranges, but the information
you gain by this method is typically the same as <code>boolean overlaps(Range other)</code>. In a planning scenario you typically want to avoid overlaps.
You would not like to find other guests plundering your minibar.</p>
</div>
<div class="paragraph">
<p>The final operation, <code>D overlap(R other)</code> can be used  to compute prices. Use case: prices vary per season,
and the length of an overlap of a reservation with seasons determines the price of the parts.</p>
</div>
<div class="paragraph">
<p>Completely in line with the Duck example in the theory, we want maximum reuse, or
as much as possible work done in the Range super type, so that a specialization has little or no work to do.</p>
</div>
<div class="paragraph">
<p>Let us start simple and show what an integer range could look like when we get the design done.
The <code>IntegerRange</code> is also the first leaf class in our design.</p>
</div>
<div class="listingblock">
<div class="title">IntegerRange is a Range of Integer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">IntegerRange</span> <span class="directive">implements</span> Range&lt;IntegerRange, <span class="predefined-type">Integer</span>, <span class="predefined-type">Integer</span>&gt; {

    <span class="directive">final</span> <span class="predefined-type">Integer</span> start;
    <span class="directive">final</span> <span class="predefined-type">Integer</span> end;

    <span class="directive">private</span> IntegerRange( <span class="predefined-type">Integer</span><span class="type">[]</span> p ) { <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="local-variable">this</span>.start = p[ <span class="integer">0</span> ];
        <span class="local-variable">this</span>.end = p[ <span class="integer">1</span> ];
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Integer</span> start() {
        <span class="keyword">return</span> start;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Integer</span> end() {
        <span class="keyword">return</span> end;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> BiFunction&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">Integer</span>, <span class="predefined-type">Integer</span>&gt; meter() { <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="keyword">return</span> ( a, b ) -&gt; b - a;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">int</span> hashCode() {
        <span class="keyword">return</span> rangeHashCode();
    }

    <span class="annotation">@Override</span>
    <span class="annotation">@SuppressWarnings</span>( <span class="string"><span class="delimiter">&quot;</span><span class="content">EqualsWhichDoesntCheckParameterClass</span><span class="delimiter">&quot;</span></span> )
    <span class="directive">public</span> <span class="type">boolean</span> equals( <span class="predefined-type">Object</span> obj ) { <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="keyword">return</span> rangeEquals( obj );
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> toString() {
        <span class="keyword">return</span> rangeToString();
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> IntegerRange between( <span class="predefined-type">Integer</span> start, <span class="predefined-type">Integer</span> end ) { <i class="conum" data-value="4"></i><b>(4)</b>
        <span class="keyword">return</span> IntegerRange.of( start, end );
    }

    <span class="directive">public</span> <span class="directive">static</span> of(<span class="predefined-type">Integer</span> start, <span class="predefined-type">Integer</span> end) {
        <span class="keyword">return</span> <span class="keyword">new</span> IntegerRange(  Range.minmax( start, end ) ); <i class="conum" data-value="5"></i><b>(5)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Private helper constructor that takes an array of two T&#8217;s</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This method returns a function in the form of a lambda expression</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The interface defines helper methods for equals and hashcode. Because you cannot
overwrite methods of a class in an interface, we use this trick to avoid duplicate work or copy-and-waste-errors.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Factory helper that can be used by the default methods in the Range interface</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Using helper method that ensures that parameters are passed in correct order.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">IntegerRange as Java 16+ feature, less boilerplate.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> record IntegerRange( <span class="predefined-type">Integer</span> start, <span class="predefined-type">Integer</span> end) <span class="directive">implements</span>
        Range&lt;IntegerRange, <span class="predefined-type">Integer</span>, <span class="predefined-type">Integer</span>&gt; {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> BiFunction&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">Integer</span>, <span class="predefined-type">Integer</span>&gt; meter() {
        <span class="keyword">return</span> ( a, b ) -&gt; b - a;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> IntegerRange between( <span class="predefined-type">Integer</span> start, <span class="predefined-type">Integer</span> end ) {
        <span class="keyword">return</span> <span class="keyword">new</span> IntegerRange( start, end );
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Integer</span> zero() {
        <span class="keyword">return</span> <span class="integer">0</span>;
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When you want to enable java preview features with projects that use sebipom,
set the <mark>java.release</mark> to the version you want to use, and
add a build section to tell the compiler to turn on the preview-features.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">   <span class="tag">&lt;java.release&gt;</span>16<span class="tag">&lt;/java.release&gt;</span>
.
.

  <span class="tag">&lt;build&gt;</span>
        <span class="tag">&lt;plugins&gt;</span>
            <span class="tag">&lt;plugin&gt;</span>
                <span class="tag">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/groupId&gt;</span>
                <span class="tag">&lt;artifactId&gt;</span>maven-compiler-plugin<span class="tag">&lt;/artifactId&gt;</span>
                <span class="tag">&lt;configuration&gt;</span>
                    <span class="tag">&lt;compilerArguments&gt;</span>--enable-preview<span class="tag">&lt;/compilerArguments&gt;</span>
                    <span class="tag">&lt;compilerArgs&gt;</span>
                        <span class="tag">&lt;arg&gt;</span>--enable-preview<span class="tag">&lt;/arg&gt;</span>
                    <span class="tag">&lt;/compilerArgs&gt;</span>
                <span class="tag">&lt;/configuration&gt;</span>
            <span class="tag">&lt;/plugin&gt;</span>
        <span class="tag">&lt;/plugins&gt;</span>
  <span class="tag">&lt;/build&gt;</span></code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">The Range interface class header</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/**
 * Range with start and end and some operations.
 *
 * @param &lt;R&gt; self referencing range type.
 * @param &lt;P&gt; the demarcation type of start and end point.
 * @param &lt;D&gt; the distance Dimension between start and end points.
 */</span>
 <span class="directive">public</span> <span class="type">interface</span> <span class="class">Range</span>&lt;R <span class="directive">extends</span> Range&lt;R,P,D&gt;,
                        P <span class="directive">extends</span> <span class="predefined-type">Comparable</span>&lt;? <span class="local-variable">super</span> P&gt;,
                        D <span class="directive">extends</span> <span class="predefined-type">Comparable</span>&lt;? <span class="local-variable">super</span> D&gt;
                        &gt;
        <span class="directive">extends</span> <span class="predefined-type">Comparable</span>&lt;R&gt;, <span class="predefined-type">Serializable</span> {
<span class="comment">// code omitted</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The interface definition may look a bit daunting but it reads as:<br>
<em>a range which has subtypes <code class="blue">R</code>, and has two <span class="blue">Comparable</span> endpoints of type <code class="blue">P</code>, with distance of type <code class="blue">D</code> and is itself <span class="blue">Comparable</span>
  with something of it&#8217;s own type [blue]`R`</em>.
The comparison is done by comparing the starting boundaries, a and c in the drawings above.</p>
</div>
<div class="paragraph">
<p>The type parameters are a bit special, because generic ranges may have endpoints of a different type
than the distance between them. Compare to two locations on earth. The location is expressed as <a href="https://www.latlong.net/">lat-long</a> which
is a two-dimensional value, but the distance is expressed as a length in meters, kilometers, or miles.<br>
Same for time and dates. A date is a position on some scale with an arbitrary origin, like the Gregorian Calendar,
but the 'distance' is not of type date, but of some
kind of time-duration such or <code>Period</code> of <code>Duration</code>. If you ask a Duration its 'length', you need to specify the unit, such
as <code>ChronoUnit.DAYS</code>, <code>ChronoUnit.HOURS</code> or <code>ChronoUnit.NANOS</code>.</p>
</div>
<div class="paragraph">
<p>The definition of the leaf class <code>LocalDateTimeRange</code> therefore looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">LocalDateTimeRange</span> <span class="directive">implements</span> Range&lt;LocalDateRange, LocalDateTime, <span class="predefined-type">Duration</span>&gt; {
  <span class="comment">// code omitted</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/time/temporal/ChronoUnit.html" target="_blank" rel="noopener">ChronoUnit </a>
allows the range to be measured in any of the unit types defined in that <code>enum</code>, from nano seconds to centuries, with days somewhere in between.
Not all units are applicable all of the time. HOURS and DAYS are precise, but MONTHS and YEARS are not, because they vary in length.</p>
</div>
<div class="paragraph">
<p>The interesting or special methods defined in the interface may also need some explanation.</p>
</div>
<div class="listingblock">
<div class="title">Between. Note that <strong class="blue">a</strong> is included, <strong class="red">b</strong> is excluded in the range a-b</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"> <span class="comment">/**
   * Is a midpoint between a (inclusive) and b (exclusive).
   *
   * @param a first point
   * @param b second
   * @param inBetween point
   * @return true if inBetween is at or after a and strictly before b.
   */</span>
  <span class="keyword">default</span> <span class="type">boolean</span> isBetween( P a, P b, P inBetween ) {
      <span class="keyword">return</span> a.compareTo( inBetween ) &lt;= <span class="integer">0</span> &amp;&amp; inBetween.compareTo( b ) &lt; <span class="integer">0</span>;
  }</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Do two ranges have points in common?</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/**
 * Does this range overlap with another one.
 *
 * @param other to check
 * @return true on overlap with other
 */</span>
<span class="keyword">default</span> <span class="type">boolean</span> overlaps( R other ) {
    <span class="comment">// code left as exercise</span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">The getLength() method evaluates the method returned by the meter() method implemented in the above class.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/**
 * Get the length of this range in some unit. The effective operation is
 * (end - start), but since we do not know how to subtract the sub-types,
 * that is left to the implementer. The exception thrown on incompatibility
 * of range and unit is also left to the implementer.
 *
 * @param unit of measurement
 * @return the length
 * @throws RuntimeException when the unit and this range are not compatible
 */</span>
<span class="keyword">default</span> <span class="type">long</span> getLength( D unit ) {
    <span class="keyword">return</span> meter().apply( <span class="local-variable">this</span>.start(), <span class="local-variable">this</span>.end() );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code class="blue">default</code> method above uses the abstract method below.</p>
</div>
<div class="listingblock">
<div class="title">The measurement <em class="blue">device</em> is a BiFunction&lt;P,P,D&gt; that is applied in the above method.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="comment">/**
     * Return the 'device' to measure the distance between two points Compute the distance in dimension D.
     * The implementer has the choice to return a class, lambda expression, or a (static) method reference.
     * The lambda has two inputs of type P: a and b.
     *
     * @return the distance meter lambda or BiFunction Implementation.
     */</span>
    BiFunction&lt;P,P,D&gt; meter();
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">One of methods that makes the Range interface and its sub-classes worth their keep.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/**
 * Compute the length that this and an other range overlap.
 *
 * @param other range
 * @param unit of measurement
 * @return the length of the overlap as a number of 'long' units
 */</span>
<span class="keyword">default</span> D overlap( R other ) {
   <span class="comment">// sorry, this is your work. And 0 is wrong most of the time.</span>
}</code></pre>
</div>
</div>
<div id="punchthrough" class="imageblock">
<div class="content">
<img src="./images/punchthrough.svg" alt="punchthrough">
</div>
<div class="title">Figure 7. The punch only punches if it has a full hit</div>
</div>
<div class="listingblock">
<div class="title">The punching on test stage as shown in figure <a href="#punchthrough">The punch only punches if it has a full hit</a></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">   Stream&lt;Range&lt;R, T, U&gt;&gt; result = range.punchThrough( punch ); <i class="conum" data-value="1"></i><b>(1)</b>
   assertThat( result )
        .as( <span class="string"><span class="delimiter">&quot;</span><span class="content">punch </span><span class="delimiter">&quot;</span></span> + range + <span class="string"><span class="delimiter">&quot;</span><span class="content"> with </span><span class="delimiter">&quot;</span></span> + punch )
        .containsExactlyElementsOf( expectedParts );</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Note that the punch operation takes a single <code>Range punch</code> but produces a Stream that contains<br>
<div class="ulist">
<ul>
<li>
<p>Either the 'green' range as a whole, in case the punch 'missed', or more formally is not completely contained in the target,</p>
</li>
<li>
<p>part(s) of the green range and the punch as a whole,</p>
</li>
<li>
<p>or only the punch if it completely knocks out and thereby replaces the green range. In this last case the punch and target completely overlap.</p>
</li>
</ul>
</div></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>From the above you can infer that the resulting <code class="blue">Stream</code> from the <span class="blue">punchThrough</span> operation has at least one (1) element and at most three (3).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Whenever a method produces a Stream from an element of a Stream with a single operation,
<a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/stream/Stream.html#flatMap(java.util.function.Function)">flatMap</a>
 is your friend.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Parameterized Tests</strong><br>
Many of the tests in the Ranges project are parameterized.
Test driven in this instance means adding a row of test data to the data source, or un-comment a row.</p>
</div>
<div class="paragraph">
<p>In this first part you need to complete the Range and RangeTest in the given project using the IntegerRange as leaf class.</p>
</div>
<div class="paragraph">
<p>Range types expected at the end of this part:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Range</th>
<th class="tableblock halign-left valign-top">Point</th>
<th class="tableblock halign-left valign-top">Distance</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IntegerRange</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
</tr>
</tbody>
</table>
</details></div><!--end genericranges2.adoc -->
</div>
</div>
</div>
<div class="sect1">
<h2 id="_design_for_extension_and_reusing_generics_tests"><a class="anchor" href="#_design_for_extension_and_reusing_generics_tests"></a><a class="link" href="#_design_for_extension_and_reusing_generics_tests">5. Design for Extension and Reusing Generics Tests.</a></h2>
<div class="sectionbody">
<div class="paragraph">
<div class="title">Initial test situation</div>
<p><span class="image thumb left"><img src="./images/rangetest.svg" alt="rangetest"></span>
The Range interface can be nicely implemented into leaf classes such as IntegerRange, which you already
implemented in the exercise above. It can also be implemented by time based ranges such as <code class="blue">LocalDateRange</code> and <code class="blue">LocalDateTimeRange</code>, and <code class="blue">InstantRange</code>.
The first two may sound familiar, but actually the third is the precise one. The other two deal with the quirks of daylight saving time,
which is a political invention to make our getting out of bed early in April hard.<br>
You invested a lot into the <code class="blue">RangesTest</code> test classes, with <code class="blue">IntegerRange</code> as the first concrete of leaf class on the Range type tree.
Now we want to preserve the investment. The trick is to again use generics and 'leaf' classes, but now on the testing side of the project.</p>
</div>
<div class="paragraph">
<p>The idea is in the class diagram below.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/generictestclasses.svg" alt="generictestclasses">
</div>
<div class="title">Figure 8. Generics on both sides of the business/test divide.</div>
</div>
<div class="paragraph">
<p>The cyan leafs and the green leaf classes are the pairs of business and test classes.
We kept the data provider and the test class as separate classes, because we think the responsibilities are different.
However, an approach where the test-leaf-class provides the data would be just as valid.</p>
</div>
<div class="paragraph">
<p>You are going do a little bit of copying, starting from the <code class="blue">RangeTest</code> class.</p>
</div>
<div class="admonitionblock note extra">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="EXTRA CHALLENGE"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The approach will take a little perseverance, because before you can make your code better, you
have to break some.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We want to turn a concrete <em>test</em> class, with concrete data, <em>testing</em> against a leaf class, into a generic test class.
We start by copying the class, <code class="blue">RangeTest</code> to <code class="blue">RangeTestBase</code>. Because the type name no longer ends in <strong>Test</strong>, it is no Longer considered
a test class by itself. It will serve as the root or super of a set of leaf test-classes. These leave&#8217;s names do end in Test, but will do only minimal configuration.
A bit like the duck earlier in this part.
They will also make explicit what kind of Range they test by using concrete classes at the places of the type parameters.
As example <strong>IntegerRangTest</strong> is declared as <code class="blue">public class IntegerRangeTest extends RangeTestBase&lt;IntegerRange, Integer, Integer&gt;</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong class="big">Readability is key</strong>. That also applies to tests and test data. We use a, b, c, and d in the images
and therefor want to stick to those same "names" in the tests, so that a test value record "ab,cd" is easily understood as two disjunct ranges
and "ac,bd" as two overlapping ones. That would be hard with array indices. Our first approach was to use a map to do the translation, but creating the map
is a lot of typing even with Map.of(&#8230;&#8203;). So we use an array of test data and index it with this trick, where the key is a String, in which only the first character is
significant.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    */
    <span class="predefined-type">Integer</span> getPoint( <span class="predefined-type">String</span> key ) {
        <span class="keyword">return</span> pointsA[ key.charAt( <span class="integer">0</span> ) - <span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span> ]; <i class="conum" data-value="1"></i><b>(1)</b>
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We know that the keys will be adjacent and start with a, so <code>character -'a'</code> produces the integer index into the array.</td>
</tr>
</table>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the first part of the Generic Range exercise all tests use a limited set of test values, basically just points, <strong>a</strong>, <strong>b</strong>, <strong>c</strong>, <strong>d</strong>, <strong>e</strong>, and <strong>f</strong>.
The only requirement to those points is that they are in ascending order <code class="blue">a &lt; b &lt; c &lt; d &lt; e &lt; f</code>.
In <code class="blue">RangeTestBase</code> we replace the use of <strong>concrete</strong> test values A, B, C, etc.  into <em>method calls</em> on some data generic factory, but instantiated for
our concrete test case, <code class="blue">Integer</code>.
The Generic Helper <code class="blue">abstract class RangeTestDataFactory</code> has methods to lookup points and to create ranges from String specifications.
one method to create a range: <code>R createRange( P start, P end );</code>.</p>
</div>
<div class="paragraph">
<p>The test-leaf, that is the <code class="blue">IntegerRangeTest</code> creates its helper specialization, the <code class="blue">RangeTestDataFactory</code>, as an <em>anonymous</em> inner class,
just like in the class diagram above.</p>
</div>
<div class="paragraph">
<p>For <code class="blue">IntegerRangeTest</code> it and it&#8217;s inner class looks like the class below.
You only see trivial methods that configure the <code class="blue">RangeTestDataFactory</code>, which is the actual name of the <strong class="blue">Generic Helper</strong> class.</p>
</div>
<div class="listingblock">
<div class="title">IntegerRangeTest class, the whole of it.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">nl.fontys.sebivenlo.ranges</span>;

<span class="keyword">import</span> <span class="include">java.util.Map</span>;
<span class="directive">public</span> <span class="type">class</span> <span class="class">IntegerRangeTest</span> <span class="directive">extends</span> RangeTestBase&lt;IntegerRange, <span class="predefined-type">Integer</span>, <span class="predefined-type">Integer</span>&gt; {

    RangeTestDataFactory&lt;IntegerRange, <span class="predefined-type">Integer</span>, <span class="predefined-type">Integer</span>&gt; daf; <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="predefined-type">Integer</span><span class="type">[]</span> points={ <span class="integer">42</span>, <span class="integer">51</span>, <span class="integer">55</span>, <span class="integer">1023</span>, <span class="integer">1610</span>, <span class="integer">2840</span>  };

    <span class="annotation">@Override</span>
    RangeTestDataFactory&lt;IntegerRange, <span class="predefined-type">Integer</span>, <span class="predefined-type">Integer</span>&gt; helper() {
        <span class="keyword">if</span> ( <span class="predefined-constant">null</span> == daf ) {                                  <i class="conum" data-value="2"></i><b>(2)</b>
            daf = <span class="keyword">new</span> RangeTestDataFactory&lt;&gt;( points ) { <i class="conum" data-value="3"></i><b>(3)</b>
                <span class="annotation">@Override</span>
                IntegerRange createRange( <span class="predefined-type">Integer</span> start, <span class="predefined-type">Integer</span> end ) {
                    <span class="keyword">return</span> IntegerRange.of( start, end );
                }
                <span class="annotation">@Override</span>
                <span class="predefined-type">Integer</span> distance( <span class="predefined-type">Integer</span> a, <span class="predefined-type">Integer</span> b ) {
                    <span class="keyword">return</span> b - a;
                }
            };
        }
        <span class="keyword">return</span> daf;                                           <i class="conum" data-value="4"></i><b>(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Cache instance.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Test if we have a cached value.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Start of anonymous inner class.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Return the cache.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the above code we cache the result of the first invocation of <code>helper()</code>, to avoid creating
a new instance on each call. It speeds things up a bit and is less wasteful on object allocation.</p>
</div>
<div class="sect2">
<h3 id="_exercise_generic_ranges_2_adding_tests_and_leafs"><a class="anchor" href="#_exercise_generic_ranges_2_adding_tests_and_leafs"></a><a class="link" href="#_exercise_generic_ranges_2_adding_tests_and_leafs">Exercise Generic Ranges 2: Adding tests and Leafs</a></h3>
<div class='ex'><details open class='ex'><summary class='ex'>Generic Ranges Part 2</summary>
<div class="paragraph">
<p><strong>Plan</strong> We are going to <em>refactor</em> our tests, so that we get tests for new leaf classes
almost for free. See the explanation in the part above.</p>
</div>
<div class="paragraph">
<p>The idea is that you separate the test data from the tests. Doing this in a generic way
allows you to specify the tests in terms of the generic types, <strong>R</strong>, <strong>P</strong>, and <strong>D</strong>. Let this be mnemonic for <em><strong>R</strong>ange between <strong>P</strong>oints at a <strong>D</strong>istance</em>.</p>
</div>
<div class="paragraph">
<p>There will a test base class <code>RangeTestBase</code>, generic with the type tokens R,P and D.
The Leaf-Test class then only has to provide
a test data provider or factory. The <code class="blue">RangeTestBase</code> class defines a helper() method that returns an instance
of a <code class="blue">RangeTestDataFactory</code>, that has to be configured for the specific test leaf class.</p>
</div>
<div class="paragraph">
<p>The test data factory is of course defined as a generic type, an <span class="blue">abstract class</span> to be precise.</p>
</div>
<div class="paragraph">
<p>To do that follow the plan described in the text above:</p>
</div>
<div class="paragraph">
<p>First define the <code>RangeTestDataFactory</code> <span class="blue">abstract class</span>. Actually, it is already in the project.
This is an abstract class, because that allows us to 'pull' the test helper methods
into this factory, so that the data massaging to get the types right can be done in that class.
The important factory methods are <code class="blue">createRange</code>, and <code class="blue">distance</code>, both <span class="blue">abstract</span>.
The factory also expects a map of String to P: Map&lt;String,P&gt;, that allows it to create points, ranges,
and distances with the given abstract methods, so that it can produce the test values that are required (and actually already are) in the tests.
Remember we started by copying the complete test class for the IntegerRange as a starting point.</p>
</div>
<div class="listingblock">
<div class="title">Important members of RangeTestDataFactory.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">RangeTestDataFactory</span>&lt;R,P,D &gt; { <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="directive">protected</span> <span class="directive">final</span> p<span class="type">[]</span> points;  <i class="conum" data-value="2"></i><b>(2)</b>

    <span class="comment">/**
     * Remember the type of the class under test.
     *
     */</span>
    <span class="directive">protected</span> RangeTestDataFactory( P<span class="type">[]</span> points ) {
        <span class="local-variable">this</span>.points = points;
    }

    <span class="comment">/**
     * Lookup up a point from the spec.
     * @param key for lookup
     * @return the mapped value.
     */</span>
    P lookupPoint( <span class="predefined-type">String</span> key ) {
        <span class="keyword">return</span> points.get( key );
    }

    <span class="comment">/**
     * Create a test range,`P a()`,
     *
     * @param start or range
     * @param end   of range
     * @return the range
     */</span>
    <span class="directive">abstract</span> R createRange( P start, P end );   <i class="conum" data-value="3"></i><b>(3)</b>

    <span class="directive">abstract</span> D distance(P a, P b);              <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="comment">// remainder left out</span>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Simple type tokens are enough.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Point lookup, to be provided by leaf configuration.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>and</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>helper methods to be provided by the factory leaf (inner) class.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The factory leaf classes have to implement the abstract methods and pass a map of points via the constructor.
In all classes they have been implemented using an <em>anonymous</em>  inner class.
For LocalDateRange that inner class definition looks like the code below, the other inner classes look similar enough.
Again you see that the abstract methods are trivially implemented.
The construction used is very much like the typical way an Iterable&lt;T&gt; class returns the requited Iterator&lt;T&gt;.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We have chosen <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/time/Duration.html"><strong>Duration</strong></a> as the type for distance with LocalDate instead of the more 'natural' <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/time/Period.html"><em>Period</em></a>,
because we think it is useful to have the demarcation points of a range to be comparable, so you can tell early and late apart.
Period is NOT comparable, because it cannot keep that promise in all cases, because of the invention of <strong>daylight saving</strong>,
where you loose and hour of sleep in Spring and gain one when you don&#8217;t need it in the autumn. That&#8217;s politics for you.
And even without daylight saving, the idea of leap year and leap day also throw some fly in the ointment.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">LocalDataRangeTest inner class extending RangeTestFactory</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">   RangeTestDataFactory&lt;LocalDate, <span class="predefined-type">Duration</span>, LocalDateRange&gt; daf;

   <span class="directive">static</span> <span class="directive">final</span> ChronoUnit UNIT = ChronoUnit.DAYS;

   <span class="directive">static</span> <span class="directive">final</span> LocalDate A = LocalDate.EPOCH.plus( <span class="integer">12</span>, UNIT );

   <span class="directive">static</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, LocalDate&gt; dateMap = <span class="predefined-type">Map</span>.of(     <i class="conum" data-value="1"></i><b>(1)</b>
           <span class="string"><span class="delimiter">&quot;</span><span class="content">a</span><span class="delimiter">&quot;</span></span>, A,
           <span class="string"><span class="delimiter">&quot;</span><span class="content">b</span><span class="delimiter">&quot;</span></span>, A.plus( <span class="integer">5</span>, UNIT ),
           <span class="string"><span class="delimiter">&quot;</span><span class="content">c</span><span class="delimiter">&quot;</span></span>, A.plus( <span class="integer">7</span>, UNIT ),
           <span class="string"><span class="delimiter">&quot;</span><span class="content">d</span><span class="delimiter">&quot;</span></span>, A.plus( <span class="integer">14</span>, UNIT ),
           <span class="string"><span class="delimiter">&quot;</span><span class="content">e</span><span class="delimiter">&quot;</span></span>, A.plus( <span class="integer">21</span>, UNIT ),
           <span class="string"><span class="delimiter">&quot;</span><span class="content">f</span><span class="delimiter">&quot;</span></span>, A.plus( <span class="integer">28</span>, UNIT )
   );

   <span class="annotation">@Override</span>
   RangeTestDataFactory&lt; LocalDateRange, LocalDate, <span class="predefined-type">Duration</span>&gt; helper() {
       <span class="keyword">if</span> ( <span class="predefined-constant">null</span> == daf ) {
           daf = <span class="keyword">new</span> RangeTestDataFactory&lt;&gt;( dateMap ) { <i class="conum" data-value="2"></i><b>(2)</b>
               <span class="annotation">@Override</span>
               LocalDateRange createRange( LocalDate start, LocalDate end ) {
                   <span class="keyword">return</span> LocalDateRange.of( start, end );
               }
               <span class="annotation">@Override</span>
               <span class="predefined-type">Duration</span> distance( LocalDate a, LocalDate b ) {
                   <span class="keyword">return</span> <span class="predefined-type">Duration</span>.between( a, b );
               }
           };
       }
       <span class="keyword">return</span> daf;
   }
   <span class="comment">// public static void main( String[] args ) {</span>
   <span class="comment">//      new LocalDataRangeTest(); </span><i class="conum" data-value="3"></i><b>(3)</b>
   <span class="comment">//  }</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Data set for LocalDateRangeTest.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Start of anonymous inner class defining Test Factory leaf class, at the same time
Passing the map to the super class, i.e. RangeTestDataFactory.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Main that helped to show what went wrong.</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In the test data you see the use of a ChronoUnit. I have run into trouble when I selected
some value that looked useful, like ChronoUnit.YEARS, but was called back from that choice by the Runtime,
because not all values defined in ChronoUnit are allowed in all cases.
Because the error was covered by a lot of testing output, I added a tiny main method, which you can see commented out above. That revealed that
Duration choked on the wrong choice of ChronoUnit. That is a tip in disguise: You can simply add a main to a test class, to see what happens when you
run it as a normal class.<br></p>
</div>
<div class="paragraph">
<p>That is why I choose <strong class="green">DAYS</strong> with <code class="blue">LocalDate</code> ranges, and <strong class="green">HOURS</strong> with <code class="blue">LocalDateTimeRanges</code>. For instance <span class="red">YEARS</span> does not work.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Your task:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Copy your class RangeTest to RangeTestBase, and make it generic by adding
the following declaration:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">abstract</span> <span class="type">class</span> <span class="class">RangeTestBase</span>&lt;
              R <span class="directive">extends</span> Range&lt;R, P, D&gt;,
              P <span class="directive">extends</span> <span class="predefined-type">Comparable</span>&lt;? <span class="local-variable">super</span> P&gt;,
              D <span class="directive">extends</span> <span class="predefined-type">Comparable</span>&lt;? <span class="local-variable">super</span> D&gt;
              &gt;
               {
                <span class="comment">// class left out</span>
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Give RangeTestBase one abstract method <code class="blue">abstract RangeTestDataFactory&lt;R, P, D&gt; helper();</code>,
that returns a data factory.</p>
</li>
<li>
<p>Adapt all tests so that any use of <code class="blue">Integer</code> as Point is replaced by generic <code class="blue">P</code>,
any use of <code class="blue">Integer</code> as distance by generic <code class="blue">D</code>, and any <code class="blue">IntegerRange</code> by the generic <code class="blue">R</code>.</p>
</li>
<li>
<p>Create an <code class="blue">IntegerRangeTest</code> as given above. It is a leaf class of <code class="blue">RangeTestBase</code> and only
configures the helper with the anonymous inner class Implementation
of the <code class="blue">RangeTestDataFactory</code>.</p>
</li>
<li>
<p>Now make sure that the test results are the same as before with the simple RangeTest.<br>
You may want to <strong class="green">disable</strong> the whole RangeTest class by putting an <code class="gray">@Disabled</code> annotation
on the class, so that you can see only one class doing its work.<br>
In this way you are effectively testing the new test. You can of course also inspect
the code coverage, to see if indeed all code of the target business class is put through it&#8217;s paces.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Next you apply this to create more range leaf classes. Start with <code class="blue">LongRange</code>:
<code class="blue">public class LongRange implements Range&lt;LongRange, Long, Long&gt;</code>.</p>
</div>
<div class="paragraph">
<p>First create the test class: <strong class="blue">LongRangeTest</strong>. Mold it after the pattern in IntegerRangeTest. Copy and replace Integer with Long
works in most cases.<br>
Then implement <strong class="blue">LongRange</strong>. Here too most is prescribed by the Range interface.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Implement the two fields as <span class="blue">final</span>, add a <span class="blue">private</span> constructor that takes an array of long and uses the
first two values,</p>
</li>
<li>
<p>create the public static <code class="blue">of( Long start, long end )</code> method and in it use the private constructor like so:
 <code class="blue">return new LongRange( Range.minmax( start, end ) );</code>.<br>
The static helper in Range  <code class="blue">P[] Range.minmax(P,P)</code> returns an array with two elements, minimum value first, to
help ensure that the least value lands at the start of a Range.</p>
</li>
<li>
<p>Implement the methods that are defined <strong class="blue">abstract</strong> in <span class="blue">Range</span>. They might already have been generated by the IDE,
with bodies throwing a <code class="red">UnsupportedOperationException</code>. Replace the body with the correct return expression. All abstract methods are non-void.</p>
</li>
<li>
<p><strong>Override</strong> the methods <strong class="blue">equals</strong>, <strong class="blue">hashCode</strong> and <strong class="blue">toString</strong> inherited from Object. You can&#8217;t override a
method of a concrete class in an interface, you must do it here.<br>
But most work is already done in <span class="blue">Range</span>, because these three methods only use the fields.
For all said methods there is a equivalent <strong class="green">rangeXXX</strong>, which you can use to do the work.
In case of equals, do it like this:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@Override</span>
    <span class="annotation">@SuppressWarnings</span>( <span class="string"><span class="delimiter">&quot;</span><span class="content">EqualsWhichDoesntCheckParameterClass</span><span class="delimiter">&quot;</span></span> )
    <span class="directive">public</span> <span class="type">boolean</span> equals( <span class="predefined-type">Object</span> obj ) {
        <span class="keyword">return</span> rangeEquals( obj );
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Make sure everything still works for both classes and their tests.</p>
</div>
<div class="paragraph">
<p>Then continue with:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Instant</strong> (point in time). For 'distance' use Duration.</p>
</li>
<li>
<p><strong>LocalDateRange</strong>. For 'distance' use Duration.</p>
<div class="ulist">
<ul>
<li>
<p>Test for a getDays() method that tells the length in days. Implement getDays.</p>
</li>
<li>
<p>Test for an isBefore(LocalDate) method, which can tell if the whole range is before a date. Implement isBefore.<br>
Similar for isAfter.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>LocalDateTimeRange</strong>. For 'distance' use Duration.</p>
<div class="ulist">
<ul>
<li>
<p>Add isBefore and isAfter similar to LocalDateRange.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>You get 67 tests per implemented range, maybe a few more if the range has some specialized needs, like LocalDateRange.
<strong class="big">Do not forget to override the methods <span class="blue">equals</span>, <span class="blue">hashCode</span>, and <span class="blue">toString</span></strong>, or some of the tests will fail.</p>
</div>
<div class="paragraph">
<p>More useful ranges to come.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>DoubleRange</strong>. For 'distance' use Double.</p>
</li>
<li>
<p><strong>BigIntegerRange</strong>. For 'distance' use BigInteger.</p>
</li>
<li>
<p><strong>BigDecimalRange</strong>. For 'distance' use BigDecimal.</p>
<div class="ulist">
<ul>
<li>
<p>For BigDecimal  you may run into the issue that the  overlap test method tells that <strong>0</strong> and <strong>0E27</strong> (ZERO at some large exponent)
are not equal. You can either suppress the test by overriding it in the leaf test class and effectively silence it by commenting
out the super call, or, better, improving the <code class="blue">distance</code> method in the <em>test</em> leaf class and the <code class="blue">meter</code> method in the BigIntegerRange class.
The later will then look like:</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">if two points are equal, the return ZERO distance.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">    <span class="annotation">@Override</span>
    <span class="directive">public</span> BiFunction&lt;<span class="predefined-type">BigDecimal</span>, <span class="predefined-type">BigDecimal</span>, <span class="predefined-type">BigDecimal</span>&gt; meter() {
        <span class="keyword">return</span> ( a, b ) -&gt; {
            <span class="keyword">if</span> ( a.equals( b ) ) {
                <span class="keyword">return</span> <span class="predefined-type">BigDecimal</span>.ZERO;
            }
            <span class="keyword">return</span> b.subtract( a );
        };
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you still not satisfied, find other comparable 'points', define their distance function and implement those too. Tests first of course.</p>
</div>
<div class="paragraph">
<p>Our version gives us <strong class="green">486</strong> successful tests with a coverage of <strong class="green">100%</strong>. YMMV.</p>
</div>
<div class="paragraph">
<p>Range types expected at the end of this part:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Range</th>
<th class="tableblock halign-left valign-top">Point</th>
<th class="tableblock halign-left valign-top">Distance</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LongRange</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Long</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Long</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">InstantRange</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LocalDateRange</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LocalDate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LocalDateTimeRange</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LocalDateTime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duration</p></td>
</tr>
</tbody>
</table>
</details></div><!--end genericranges3.adoc -->
<div class="paragraph">
<p>By completing the above exercise you will have learned that there can be reuse in tests as well,
you only need to know what tricks to apply.</p>
</div>
<div class="paragraph">
<p>More useful ranges to come, but first back to some explanation.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_reading"><a class="anchor" href="#_reading"></a><a class="link" href="#_reading">Reading</a></h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Horstmann, Ed 11, chapter 8, Generic Programming section 8.1-8.8</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_slides"><a class="anchor" href="#_slides"></a><a class="link" href="#_slides">Slides</a></h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="../pdf/031_generics_sheets_en.pdf" target="_blank" rel="noopener">Generics</a>.</p>
</li>
<li>
<p>Lesson demos in repository: <a href="https://www.fontysvenlo.org/svn/2021/prc2/svnroot/lessondemos/" class="bare">https://www.fontysvenlo.org/svn/2021/prc2/svnroot/lessondemos/</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>[TIP] The generic ranges exercise had a third part, but that has been dropped and may be part of a future week.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exercises_in_this_part"><a class="anchor" href="#_exercises_in_this_part"></a><a class="link" href="#_exercises_in_this_part">Exercises in this part</a></h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="#_exercise_generic_box">Exercise Generic Box</a></p>
</li>
<li>
<p><a href="#_exercise_shapefilter">Exercise Shape Filter</a></p>
</li>
<li>
<p><a href="#_exercise_generic_ranges_part_1">Exercise Generic Ranges part 1</a></p>
</li>
<li>
<p><a href="#_exercise_generic_ranges_2_adding_tests_and_leafs">Exercise Generic Ranges part 2: adding tests and Leafs</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. actually a specialized type is the C++ approach, not better or worse, but different
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. those at the bottom in the class diagram tree
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-11-21 10:51:07 +0100
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
<!-- hello -->
<button onclick="topFunction()" id="top-button" title="Go to top of the page">&#x21EA;Top</button>

<script>
//Get the button
var mybutton = document.getElementById("top-button");

// When the user scrolls down 20px from the top of the document, show the button
window.onscroll = function() {scrollFunction()};

function scrollFunction() {
  if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
    mybutton.style.display = "block";
  } else {
    mybutton.style.display = "none";
  }
}

// When the user clicks on the button, scroll to the top of the document
function topFunction() {
  document.body.scrollTop = 0;
  document.documentElement.scrollTop = 0;
}
</script>
</body>
</html>